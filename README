(These are notes about the WM8505 kernel port, please see readme.linux
for the original linux readme.txt.)

* This is based on kernel 2.6.29 sources released by VIA
  (http://lists.gpl-violations.org/pipermail/legal/2010-July/002204.html).

* The sources currently come with some sourceless binary object files
  (under via_obj.arm_v5t-2629.01) but we're hoping that will change.


******** PREREQUISITES ********

- Appropriate ARM cross-compiler toolchain (I've been using Emdebian's
  but you can use whatever you want.)


******** CONFIG **********

make menuconfig ARCH=arm


Pre-existing configs are:

* arch/arm/configs/eken_m001_debian

  A current configuration that should be suitable for running debian or other
  standard Linux distributions.


* arch/arm/configs/android_wm8505_config
* arch/arm/configs/wmt_defconfig

  These two came as-is with the source tarball.

* arch/arm/configs/wm8505_initial_config

  This file was the .config that came as-is the source tarball (different to the
  above two configs.)

* arch/arm/configs/eken_m001_factory_configuration
  
  Dump of /proc/config.gz on a factory Eken M001 kernel (different again.)


******** BUILDING ********

  make via_obj

(Copies the binary blob .os in to place)

  make ubin modules ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-

This builds a uzImage.bin for uboot. Replace CROSS_COMPILE with your
cross-compiler as appropriate.

  make modules_install ARCH=arm INSTALL_MOD_PATH=/some/staging/path


******* u-boot script ******

U-boot script saved in 'script/scriptcmd' on SD card. To read a scriptcmd:

  tail -c +72 scriptcmd

To write a scriptcmd:

	mkimage -A arm -O linux -T script -C none -a 1 -e 0 -n "script image" -d cmd scriptcmd

(Where 'cmd' is your source scriptcmd script)


******* kernel arguments ******

Scriptcmd has a line for kernel args:

  setenv bootargs mem=112M root=/dev/mmcblk0p2 lcdid=1 console=ttyS0,115200n

Relevant args:

* mem=112M 
  is also mem=109M on non-Android boots. Suspect extra 3M is video memory?!?

* console=ttyS0,115200n 
  gives you kernel console on serial

* lcdid=1 enables VOUT to LCD on tablets. Some other machines
  (netbooks?) use VT1632 which is the default if lcdid is not set (in
  this case, you won't see any video on a tablet.)



****** WiFi Driver ******

The rt2870sta kernel module will drive the RT3070 WiFi USB stick in
Eken M001 & friends. This was backported from kernel 2.6.35.

You will need to do two additional things

- Run these commands to turn on the Signal GPIO that powers the USB
  stick inside the Eken. We'll probably come up with something better
  eventually, but for now:

  echo out > /sys/class/gpio/gpio2/direction
  echo 1 > /sys/class/gpio/gpio2/value
  modprobe rt2870sta

  (NB: This means you can also power down the whole Wifi stick from 
  userspace to save battery, if you want, by writing 0 to /value.)  


- Install a firmware file to /lib/firmware/rt3070.bin. In debian, you
  can install firmware-ralink from non-free. Alternatively, download
  the USB firmwares from http://www.ralink.com.tw/support.php?s=2

  The rt2870.bin firmware will do as long as it's recent.

  Then udev _should_ automatically load the firmware, but it isn't
  working atm. Here is a horrible, horrible hack to load it. DO NOT
  USE THIS PERMANENTLY, ITS JUST HERE BECAUSE I'M TOO TIRED TO WORK
  OUT SOMETHING BETTER RIGHT NOW.  :)
  
  ifconfig wlan0 up &
  echo -n 1 > /sys/class/firmware/1-1/loading
  cat /lib/firmware/rt3070.bin > /sys/class/firmware/1-1/data
  echo -n 0 > /sys/class/firmware/1-1/loading




  